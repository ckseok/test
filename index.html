<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MVP A/B Test Router</title>
  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WY11P7PXE2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-WY11P7PXE2'); // 기본 page_view
  </script>
  <style>
    html,body{height:100%;margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial;display:grid;place-items:center}
  </style>
</head>
<body>
  <div>라우팅 중입니다…</div>
  <script>
  (function () {
    const KEY = 'ab_variant';
    const url = new URL(location.href);

    // 1) 쿼리로 강제 분기 허용 (?v=A|B)
    const forced = url.searchParams.get('v');
    let v = localStorage.getItem(KEY);

    if (forced === 'A' || forced === 'B') {
      v = forced;
      try { localStorage.setItem(KEY, v); } catch(e){}
    }

    // 2) 최초 방문자는 50:50로 배정
    if (!v) {
      v = Math.random() < 0.5 ? 'A' : 'B';
      try { localStorage.setItem(KEY, v); } catch(e){}
    }

    // 3) GA4 사용자 속성 동기화
    if (window.gtag) {
      gtag('set', 'user_properties', { ab_variant: v });
    }

    // 4) UTM 및 해시 보존하여 변형 페이지로 라우팅
    const qs   = location.search || '';
    const hash = location.hash   || '';
    const target = v === 'A' ? '/landing-a.html' : '/landing-b.html';

    // 현재가 이미 타깃이 아니면 이동
    if (!location.pathname.endsWith(target)) {
      location.replace(target + qs + hash);
    }
  })();
  </script>
</body>
</html>
